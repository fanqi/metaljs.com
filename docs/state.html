<!DOCTYPE html><html lang="zh-cmn-Hans"><head><meta charset="UTF-8"><title>Metal.js</title><meta name="theme-color" content="#9552ef"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/vendor/codemirror/lib/codemirror.css"><link rel="stylesheet" href="/vendor/codemirror/theme/material.css"><script src="/vendor/codemirror/lib/codemirror.js"></script><script src="/vendor/codemirror/mode/soy/soy.js"></script><script src="/vendor/codemirror/mode/javascript/javascript.js"></script><script src="http://use.typekit.net/qed5qir.js"></script><script>try{Typekit.load();}catch(e){}</script></head><body><header class="header"><div class="container"><div class="header-bg"></div><nav class="topbar"><a class="topbar-logo" href="/"><img class="topbar-logo-image" src="/images/logo_signature@2x.png" alt="Metal.js Logo" width="35" height="28"><h1 class="topbar-logo-text">Metal.js</h1></a><ul class="topbar-menu"><li class="topbar-menu-item"><a class="topbar-menu-link" href="/docs/">文档</a></li><li class="topbar-menu-item"><a class="rounded-icon topbar-icon-external" target="_blank" href="https://github.com/metal/metal"><img src="/images/github_icon.svg" alt="GitHub Icon" width="16"></a></li><li class="topbar-menu-item"><a class="rounded-icon topbar-icon-external" target="_blank" href="http://metaljs-chat.wedeploy.io/"><img src="/images/slack_icon.svg" alt="Slack Icon"></a></li></ul></nav></div></header><main class="docs"><div class="container"><div class="row"><nav class="docs-nav col-md-3"><p class="docs-nav-group">快速开始</p><ul class="docs-nav-list"><li class="docs-nav-item"><a href="/docs/" class="docs-nav-link">准备开始</a></li><li class="docs-nav-item"><a href="/docs/modal.html" class="docs-nav-link">教程：模态框</a></li><li class="docs-nav-item"><a href="/docs/modal_events.html" class="docs-nav-link">教程：模态框 - 事件</a></li><li class="docs-nav-item"><a href="/docs/modal_updates.html" class="docs-nav-link">教程：模态框 - 更新</a></li><li class="docs-nav-item"><a href="/docs/modal_nested.html" class="docs-nav-link">教程：模态框 - 嵌套组件</a></li><li class="docs-nav-item"><a href="/docs/modal_testing.html" class="docs-nav-link">教程：模态框 - 测试</a></li></ul><p class="docs-nav-group">指南</p><ul class="docs-nav-list"><li class="docs-nav-item"><a href="/docs/alias.html" class="docs-nav-link">别名</a></li><li class="docs-nav-item"><a href="/docs/state.html" class="docs-nav-link">状态</a></li><li class="docs-nav-item"><a href="/docs/component-lifecycle.html" class="docs-nav-link">组件生命周期</a></li><li class="docs-nav-item"><a href="/docs/rendering-components.html" class="docs-nav-link">渲染组件</a></li><li class="docs-nav-item"><a href="/docs/inline-events.html" class="docs-nav-link">内联事件</a></li><li class="docs-nav-item"><a href="/docs/nested-components.html" class="docs-nav-link">嵌套组件</a></li><li class="docs-nav-item"><a href="/docs/importing.html" class="docs-nav-link">导入</a></li><li class="docs-nav-item"><a href="/docs/soy-components.html" class="docs-nav-link">Soy 组件</a></li><li class="docs-nav-item"><a href="/docs/jsx-components.html" class="docs-nav-link">JSX 组件</a></li><li class="docs-nav-item"><a href="/docs/progressive-enhancement.html" class="docs-nav-link">渐进增强</a></li><li class="docs-nav-item"><a href="/docs/yeoman-generator.html" class="docs-nav-link">Yeoman 生成器</a></li><li class="docs-nav-item"><a href="/docs/building.html" class="docs-nav-link">构建</a></li><li class="docs-nav-item"><a href="/docs/performance.html" class="docs-nav-link">性能</a></li></ul></nav><article class="docs-content col-md-6 col-md-offset-1"><h1>状态</h1><p><strong>State</strong> 类为其他类提供了定义状态属性的扩展方式，也可以监控这些属性值的变化。</p><p><strong>Component</strong> 类默认扩展自<strong>State</strong>，而且当有改变时会自动重新渲染。</p><p>如果您的类不需要渲染任何东西，最好直接从 <strong>State</strong> 扩展。这样您就可以访问它的功能，而不需要继承不需要的逻辑。</p><h2>配置状态</h2><p>下面的例子是一个直接扩展自 <strong>State</strong> 的类，并且在其自身定义了一个名为 <code>number</code> 的属性：</p><textarea class="code" data-mode="javascript">
import core from 'metal';
import State from 'metal-state';

class Calculator extends State {
  /**
   * Coverts string numbers to the number type.
   */
  setNumber(val) {
    if (core.isString(val)) {
      val = parseInt(val, 10);
    }
    return val;
  }
}

Calculator.STATE = {
  number: {
    // Called whenever a new value is set. Useful when normalizing your
    // state data.
    setter: 'setNumber',

    // Accepts either number or string types. If the validator check fails,
    // the new value is discarded, and the current value kept.
    validator: val => core.isNumber(val) || core.isString(val),

    // Initial value
    value: 0
  }
}</textarea><p>如果您熟悉 <a href="http://yuilibrary.com/">YUI</a>，您可能认识这个特性，并且注意到它和属性怎样被定义很相似。 基本上你只需要列出你在 <strong>STATE</strong> 静态变量上用到的属性（在YUI中将是 <strong>ATTRS</strong>），并提供它们的配置选项，如初始值和验证器。 所有有效的属性清单，请查看 <strong>STATE</strong> 的 <a href="http://github.com/metal/metal-state/blob/c87ac15b8a9fa3ee64c421f22411f97cd376024a/src/State.js#L61">文档</a>。</p><h2>访问并更新状态</h2><p>构造函数能够接受带初始值的配置对象为它的状态属性所用。 您能访问或者改变一个对象的状态，用和您访问或改变任何对象属性相同的方式。 或者，您也能调用 <code>setState</code> 方法来通过给定的对象更新指定的属性。</p><textarea class="code" data-mode="javascript">var obj = new Calculator();
console.log(obj.number); // Prints 0

obj.number = '1';
console.log(obj.number); // Prints 1

obj.setState({number: 2});
console.log(obj.number); // Prints 2</textarea><p>您也能通过监听适当的事件来追踪状态值的改变。</p><textarea class="code" data-mode="javascript">obj.on('numberChanged', function(event) &lbrace;
// event.prevVal has the previous value.
// event.newVal has the new value.
&rbrace;);</textarea><p>想看看 <strong>State</strong> 类的所有特性，请看看它的 <a href="https://github.com/metal/metal-state/blob/master/test/State.js">单元测试</a>。</p><h2 id="config">配置数据</h2><p>任何传递给构造函数，但是并未作为状态属性被配置的数据仍然能够通过 <code>config</code> 被访问。 改变这些属性将不能被追踪，因此通常适用于您的组件的选项，这些选项只能从外部设置。</p><textarea class="code" data-mode="javascript">var obj = new Calculator({
  number: 10,
  foo: 'foo'
});
console.log(obj.number); // Prints 2
console.log(obj.foo); // Prints undefined
console.log(obj.config.foo); // Prints 'foo'</textarea></article></div></div></main><footer class="footer"><div class="container"><p class="footer-paragraph"><span class="footer-credits"><a class="rounded-icon footer-icon-liferay" target="_blank" href="http://liferay.com/"><img src="/images/liferay_logo.svg" alt="Liferay Icon" width="19" height="19"></a>由 <a class="footer-link" target="_blank" href="http://liferay.com/">Liferay, Inc</a> 为您呈现</span><span class="footer-license"><a class="footer-link" target="_blank" href="https://github.com/metal/metal/blob/master/LICENSE.md">BSD</a> 许可</span></p></div></footer><script src="/scripts/highlight.js"></script><script>
	var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?13dd41826a1d871566b7a91094c3763e";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
	</script></body></html>